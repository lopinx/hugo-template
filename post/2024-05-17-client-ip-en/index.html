<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Huabing Blog"><meta property="og:type" content="article"><meta property="og:image" content="https://images.pexels.com/photos/17398971/pexels-photo-17398971/free-photo-of-aerial-view-of-a-winding-river-and-green-forests.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=2"><meta property="twitter:image" content="https://images.pexels.com/photos/17398971/pexels-photo-17398971/free-photo-of-aerial-view-of-a-winding-river-and-green-forests.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=2"><meta name=title content="How to Get the Client‚Äôs ‚ÄúReal‚Äù IP Address with Envoy Gateway ?"><meta property="og:title" content="How to Get the Client‚Äôs ‚ÄúReal‚Äù IP Address with Envoy Gateway ?"><meta property="twitter:title" content="How to Get the Client‚Äôs ‚ÄúReal‚Äù IP Address with Envoy Gateway ?"><meta name=description content="ËµµÂåñÂÜ∞ÔºåÁ®ãÂ∫èÂëò, ÂºÄÊ∫êÁà±Â•ΩËÄÖÔºåÁîüÊ¥ªÊé¢Èô©ÂÆ∂ | ËøôÈáåÊòØ ËµµÂåñÂÜ∞ ÁöÑÂçöÂÆ¢Ôºå‰∏é‰Ω†‰∏ÄËµ∑ÂèëÁé∞Êõ¥Â§ßÁöÑ‰∏ñÁïå„ÄÇ"><meta property="og:description" content="ËµµÂåñÂÜ∞ÔºåÁ®ãÂ∫èÂëò, ÂºÄÊ∫êÁà±Â•ΩËÄÖÔºåÁîüÊ¥ªÊé¢Èô©ÂÆ∂ | ËøôÈáåÊòØ ËµµÂåñÂÜ∞ ÁöÑÂçöÂÆ¢Ôºå‰∏é‰Ω†‰∏ÄËµ∑ÂèëÁé∞Êõ¥Â§ßÁöÑ‰∏ñÁïå„ÄÇ"><meta property="twitter:description" content="ËµµÂåñÂÜ∞ÔºåÁ®ãÂ∫èÂëò, ÂºÄÊ∫êÁà±Â•ΩËÄÖÔºåÁîüÊ¥ªÊé¢Èô©ÂÆ∂ | ËøôÈáåÊòØ ËµµÂåñÂÜ∞ ÁöÑÂçöÂÆ¢Ôºå‰∏é‰Ω†‰∏ÄËµ∑ÂèëÁé∞Êõ¥Â§ßÁöÑ‰∏ñÁïå„ÄÇ"><meta property="twitter:card" content="summary"><meta name=keyword content="ËµµÂåñÂÜ∞, zhaohuabing, Zhaohuabing, , ËµµÂåñÂÜ∞ÁöÑÁΩëÁªúÊó•Âøó, ËµµÂåñÂÜ∞ÁöÑÂçöÂÆ¢, Zhaohuabing Blog, ÂçöÂÆ¢, ‰∏™‰∫∫ÁΩëÁ´ô, ‰∫íËÅîÁΩë, Web, ‰∫ëÂéüÁîü, PaaS, Istio, Kubernetes, ÂæÆÊúçÂä°, Microservice"><link rel="shortcut icon" href=/hugo-template/img/favicon.ico><title>How to Get the Client‚Äôs ‚ÄúReal‚Äù IP Address with Envoy Gateway ? | ËµµÂåñÂÜ∞ÁöÑÂçöÂÆ¢ | Zhaohuabing Blog</title>
<link rel=canonical href=/hugo-template/post/2024-05-17-client-ip-en/><link rel=stylesheet href=/hugo-template/css/bootstrap.min.css><link rel=stylesheet href=/hugo-template/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/hugo-template/css/zanshang.css><link rel=stylesheet href=/hugo-template/css/font-awesome.all.min.css><script src=/hugo-template/js/jquery.min.js></script><script src=/hugo-template/js/bootstrap.min.js></script><script src=/hugo-template/js/hux-blog.min.js></script><script src=/hugo-template/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/>Huabing Blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/hugo-template/categories/books/>books</a></li><li><a href=/hugo-template/categories/open-source/>open source</a></li><li><a href=/hugo-template/categories/presentations/>presentations</a></li><li><a href=/hugo-template/categories/tech/>tech</a></li><li><a href=/archive//>ARCHIVE</a></li><li><a href=/notes//>NOTES</a></li><li><a href=/about//>ABOUT</a></li><li><a href=/hugo-template/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(https://images.pexels.com/photos/17398971/pexels-photo-17398971/free-photo-of-aerial-view-of-a-winding-river-and-green-forests.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/envoy title=Envoy>Envoy
</a><a class=tag href=/tags/envoy-gateway title="Envoy Gateway">Envoy Gateway
</a><a class=tag href=/tags/x-forwarded-for title=X-Forwarded-For>X-Forwarded-For
</a><a class=tag href=/tags/proxy-protocol title="Proxy Protocol">Proxy Protocol</a></div><h1>How to Get the Client‚Äôs ‚ÄúReal‚Äù IP Address with Envoy Gateway ?</h1><h2 class=subheading></h2><span class=meta>Posted by
Huabing Blog
on
Monday, May 20, 2024</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>Just as a river flows from its source through various bends before reaching the sea, a typical HTTP request travels from a client across multiple network hops until it reaches its destination server.</p><p>During this journey, the request‚Äôs original IP address is lost as it moves through multiple network infrastructures such as proxy servers and load balancers. This happens because some of these hops terminate the TCP connection and create a new TCP connection with the next hop. As a result, the receiving server only sees the IP address of its directly connected hop in the chain rather than the client‚Äôs original IP address.</p><p><img src=https://zhaohuabing.com/static/img/2024-05-17-client-ip/client-ip-1.png alt></p><blockquote><p>The above diagram is a simplified representation of an HTTP request‚Äôs journey from the client to the server. Some details, such as a server may have multiple IP addresses, or the IP address may be changed by network address translation (NAT), are omitted in this diagram and the other examples in this article, so that we can focus on the main concepts.</p></blockquote><p>However, when processing the request, the backend often needs to know the client‚Äôs ‚ÄúReal‚Äù IP address for various reasons, below are some of them:</p><ul><li>Fraud Prevention: The client IP address can help identify malicious actors and enable blocking of specific IP addresses associated with abusive behavior, hacking attempts, or denial-of-service attacks.</li><li>Access Control: Some systems restrict access to certain resources based on IP addresses. Knowing the client IP address allows you to implement whitelisting policies.</li><li>User Experience: Geolocation data derived from client IP addresses can be used to tailor content to users based on their location, such as displaying localized content or language.</li><li>Application Performance: Client IP addresses are used to implement rate limiting to prevent abuse and ensure fair usage of resources. It can also be used to distribute traffic effectively and maintain session affinity.</li></ul><p>Envoy provides several methods to obtain the client‚Äôs IP address, including using the X-Forwarded-For HTTP header, custom HTTP headers, and the proxy protocol.</p><p>This article will explore these methods, detailing how to configure each one in Envoy. Additionally, we‚Äôll demonstrate how to simplify configuration using <a href=https://gateway.envoyproxy.io>Envoy Gateway</a>, and discuss leveraging the client‚Äôs IP for traffic management, such as access control and rate limiting.</p><h2 id=x-forwarded-for-http-header>X-Forwarded-For HTTP Header</h2><h3 id=what-is-x-forwarded-for>What is X-Forwarded-For?</h3><p>The X-Forwarded-For (XFF) header is a de facto standard HTTP header. It‚Äôs used to identify the originating IP address of a client connecting to a backend server through multiple proxies or load balancers.</p><p>When an HTTP request passes through a proxy or load balancer, that hop can add or update the X-Forwarded-For header with the client‚Äôs IP address. This ensures that the original client‚Äôs IP address is preserved.</p><p>This header can either include a single IP address (representing the original client) or a series of IP addresses that trace the path of the request through various proxies. Typically, it is formatted as a comma-separated list of IP addresses, like this:</p><pre tabindex=0><code>X-Forwarded-For: client, proxy1, proxy2, ‚Ä¶
</code></pre><p>Imagine an HTTP request from a client that travels through two proxies, a CDN server like AWS CloudFront, and a load balancer such as AWS ALB before reaching the server. The request path would look like this:</p><p><img src=https://zhaohuabing.com/static/img/2024-05-17-client-ip/client-ip-4.png alt></p><p>During this process, the HTTP request is relayed through two proxies, each of which originates a new TCP connection. As the request passes through each proxy, the proxy appends the source IP address of the relayed TCP connection to the X-Forwarded-For header.</p><p>Below are the source and destination addresses for each TCP connection, along with the content of the corresponding HTTP X-Forwarded-For headers:</p><table><thead><tr><th></th><th>TCP Connection</th><th>Source IP</th><th>Destination IP</th><th>XFF Header</th></tr></thead><tbody><tr><td>1</td><td>From Client to CDN</td><td>146.74.94.117</td><td>198.40.10.101</td><td></td></tr><tr><td>2</td><td>From CDN to Load Balancer</td><td>198.40.10.101</td><td>198.40.10.102</td><td>146.74.94.117</td></tr><tr><td>3</td><td>From Load Balancer to Server</td><td>198.40.10.102</td><td>Server IP</td><td>146.74.94.117,198.40.10.101</td></tr></tbody></table><p>As the above table shows, even though the source IP address changes as the request passes through each TCP connection ,the client‚Äôs IP address is preserved in the X-Forwarded-For header. The server can then extract the client‚Äôs IP address from the X-Forwarded-For header. Knowing that there are 2 hops, it selects the second value from the rightmost value.</p><p><img src=https://zhaohuabing.com/static/img/2024-05-17-client-ip/client-ip-2.png alt></p><p>The X-Forwarded-For header is a widely accepted de facto standard, making it simple to implement and read, as most proxy servers and load balancers support it.</p><p>However, there‚Äôs also a security concern to keep in mind: the X-Forwarded-For header could be easily faked. Any hop the request passes through could modify this header. So, when relying on X-Forwarded-For, make sure you trust the hops where it‚Äôs coming from.</p><h3 id=how-to-configure-x-forwarded-for-in-envoy>How to Configure X-Forwarded-For in Envoy</h3><p>Here‚Äôs how you can configure the X-Forwarded-For header in Envoy to get the client‚Äôs IP address.</p><p>Envoy offers two ways to extract the client‚Äôs IP address from the X-Forwarded-For header: through the HTTP Connection Manager (HCM) and the IP Detection Extension. Let‚Äôs go over the configuration steps for both methods.</p><h4 id=configuring-x-forwarded-for-in-hcm>Configuring X-Forwarded-For in HCM</h4><p>To configure Envoy‚Äôs HTTP Connection Manager (HCM) to extract the client‚Äôs IP from the X-Forwarded-For header, you need to set <code>xffNumTrustedHops</code>. This parameter defines the number of IP addresses in the X-Forwarded-For header that Envoy should trust. Adjust <code>xffNumTrustedHops</code> according to your network topology for proper configuration.</p><p>For instance, consider a request path like this: client -> proxy1 -> proxy2 -> Envoy. If proxy1 and proxy2 are in a trusted network and both modify the X-Forwarded-For header, the header of an HTTP request received by Envoy may look like this:</p><pre tabindex=0><code>X-Forwarded-For: client, proxy1
</code></pre><p>In this case, we need to set <code>xffNumTrustedHops</code> to 2, telling Envoy to extract the second rightmost IP address in the X-Forwarded-For header and use it as the client‚Äôs IP address for the request.</p><p>Here‚Äôs an example of the Envoy configuration for this setting:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f1fa8c>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;envoy.filters.network.http_connection_manager&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#34;typedConfig&#34;</span>: {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;@type&#34;</span>: <span style=color:#f1fa8c>&#34;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// omitted for brevity
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>   
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;xffNumTrustedHops&#34;</span>: <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As long as the number of hops set in <code>xffNumTrustedHops</code> is correct and these hops can be trusted, we can ensure that malicious users cannot forge the client IP address.</p><p>Imagine an attacker trying to pose as a legitimate client by forging the X-Forwarded-For header. In the request, he includes a fake X-Forwarded-For header like this:</p><pre tabindex=0><code>X-Forwarded-For: forged-client
</code></pre><p>The request then goes through proxy1 and proxy2, each appending the client‚Äôs IP address and proxy1‚Äôs IP address to the X-Forwarded-For header. As a result, the X-Forwarded-For header in the request that Envoy receives appears as follows:</p><pre tabindex=0><code>X-Forwarded-For: forged-client, client, proxy1
</code></pre><p>Because we set <code>xffNumTrustedHops</code> to 2, Envoy will look at the second rightmost IP address in the X-Forwarded-For header. This allows Envoyto obtain the client‚Äôs actual IP address while ignoring the fake one. Proper configuration helps protect Envoy and the backend services from attacks by malicious users.</p><p><img src=https://zhaohuabing.com/static/img/2024-05-17-client-ip/client-ip-3.png alt></p><h4 id=using-the-xff-original-ip-detection-extension>Using the XFF Original IP Detection Extension</h4><p>Apart from setting up X-Forwarded-For in HCM, you can also extract the client‚Äôs IP address using the Original IP Detection Extension. The setup is similar to HCM, but instead of configuring it directly within HCM, you use the XFF Original IP Detection Extension.</p><p>Here‚Äôs an example of how to configure X-Forwarded-For with the XFF Original IP Detection Extension:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f1fa8c>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;envoy.filters.network.http_connection_manager&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#34;typedConfig&#34;</span>: {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;@type&#34;</span>: <span style=color:#f1fa8c>&#34;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// omitted for brevity
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;originalIpDetectionExtensions&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;envoy.extensions.http.original_ip_detection.xff&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;typedConfig&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;@type&#34;</span>: <span style=color:#f1fa8c>&#34;type.googleapis.com/envoy.extensions.http.original_ip_detection.xff.v3.XffConfig&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;xffNumTrustedHops&#34;</span>: <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>Note: There‚Äôs likely a <a href=https://github.com/envoyproxy/envoy/issues/34241>bug</a> in the IP Detection Extension. The <code>xffNumTrustedHops</code> parameter needs to be set to one less than the actual number of IP addresses. For example, if you need to extract the second-to-last IP address, set xffNumTrustedHops to 1.</p><h3 id=custom-http-headers>Custom HTTP Headers</h3><p>In some cases, you may want to use a custom HTTP header to pass the client‚Äôs IP address. This approach can be useful when the standard X-Forwarded-For header is not available in a legacy system, or when you want to use a different header for security reasons, or when you want to pass additional information along with the client‚Äôs IP address.</p><h4 id=how-to-configure-custom-headers-in-envoy>How to Configure Custom Headers in Envoy</h4><p>To configure a custom header in Envoy, you need to set up the Custom Header IP Detection Extension. This extension allows you to specify a custom header to extract the client‚Äôs IP address.
For example, if we use a X-Real-IP header to store the client‚Äôs IP address, here‚Äôs how you can configure it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f1fa8c>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;envoy.filters.network.http_connection_manager&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#34;typedConfig&#34;</span>: {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;@type&#34;</span>: <span style=color:#f1fa8c>&#34;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// omitted for brevity
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;originalIpDetectionExtensions&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;envoy.extensions.http.original_ip_detection.custom_header&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;typedConfig&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;@type&#34;</span>: <span style=color:#f1fa8c>&#34;type.googleapis.com/envoy.extensions.http.original_ip_detection.custom_header.v3.CustomHeaderConfig&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;allowExtensionToSetAddressAsTrusted&#34;</span>: <span style=color:#ff79c6>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;headerName&#34;</span>: <span style=color:#f1fa8c>&#34;X-Real-IP&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><h2 id=proxy-protocol>Proxy Protocol</h2><p>Passing the client‚Äôs IP address via HTTP headers works well, but it has a limitation‚Äîit only works with HTTP. If your service also needs to support other protocols, consider using the Proxy Protocol.</p><h3 id=what-is-the-proxy-protocol>What is the Proxy Protocol?</h3><p>Proxy Protocol operates at the transport layer (TCP) to convey the client‚Äôs IP address between a proxy and a backend server.</p><p>The Proxy Protocol works by adding a header that contains the client‚Äôs IP address at the beginning of a TCP connection. This header is inserted immediately after the TCP handshake and before any application data is transmitted. As a result, it‚Äôs transparent to the application protocol and can be used with any application protocol, including HTTP, HTTPS, SMTP, and more.
<img src=https://zhaohuabing.com/static/img/2024-05-17-client-ip/proxy-protocol.png alt></p><p>Proxy Protocol has two versions: version 1 and version 2. Version 1 uses a text format that‚Äôs human-readable, while version 2 uses a binary format that‚Äôs more efficient but less readable. When using Proxy Protocol, we need to ensure that the sending and receiving servers are configured with the same version.</p><p>Although the formats are different, both versions work in a similar way. Let‚Äôs look at version 1 to understand how the Proxy Protocol works, as its format is easier to read.</p><p>The Proxy Protocol Version 1 header is a single line of text that starts with the string ‚ÄúPROXY‚Äù followed by several fields separated by spaces. Here is the format:</p><pre tabindex=0><code>PROXY &lt;INET_PROTOCOL&gt; &lt;CLIENT_IP&gt; &lt;SERVER_IP&gt; &lt;CLIENT_PORT&gt; &lt;SERVER_PORT&gt;\r\n
</code></pre><p>After the TCP connection handshake is complete, the sender sends a Proxy Protocol Header to the receiver. This header contains a few fields, what we are interested in is the client‚Äôs IP address. Then the proxy server forwards the client‚Äôs data right after the Proxy Protocol Header.</p><p>Here is an example of an HTTP request with a Proxy Protocol Header:</p><pre tabindex=0><code>PROXY TCP4 162.231.246.188 192.168.0.11 56324 443\r\n
GET / HTTP/1.1\r\n
Host: www.example.com\r\n
\r\n
</code></pre><p>In the above example:</p><ul><li>PROXY indicates that this is a Proxy Protocol header.</li><li>TCP4 indicates it‚Äôs using IPv4 and TCP protocols.</li><li>162.231.246.188 is the original client‚Äôs IP address.</li><li>192.168.0.11 is the IP address of the proxy (the sender).</li><li>56324 is the client‚Äôs port number.</li><li>443 is the proxy‚Äôs port number.</li></ul><p>When the receiver receives a new TCP connection with a Proxy Protocol Header, it first parses this header to extract the client‚Äôs IP address and other information. Then it strips the Proxy Protocol Header from the TCP data, ensuring that the actual HTTP request can be processed normally. If the receiver is also an intermediate hop supporting the Proxy Protocol, it can forward the client‚Äôs IP address to the next hop in the network, thus preserving the client‚Äôs identity throughout the request‚Äôs journey.</p><h3 id=how-to-configure-proxy-protocol-in-envoy>How to Configure Proxy Protocol in Envoy</h3><p>Here‚Äôs how to configure the Proxy Protocol in Envoy. The Proxy Protocol header is inserted during the TCP handshake, so we need to enable it in the Listener settings.</p><p>We need to add an envoy.filters.listener.proxy_protocol Listener Filter in the Listener configuration. This filter will extract the client‚Äôs IP address by parsing the Proxy Protocol Header from the first data packet of the TCP connection. After that, it strips the Proxy Protocol Header and forwards the actual application data to the HTTP Connection Manager (HCM) for further processing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f1fa8c>&#34;listener&#34;</span>: {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;@type&#34;</span>: <span style=color:#f1fa8c>&#34;type.googleapis.com/envoy.config.listener.v3.Listener&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;address&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;socketAddress&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;address&#34;</span>: <span style=color:#f1fa8c>&#34;0.0.0.0&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;portValue&#34;</span>: <span style=color:#bd93f9>10080</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// omitted for brevity
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;listenerFilters&#34;</span>: [
</span></span><span style=display:flex><span>    { 
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;envoy.filters.listener.proxy_protocol&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;typedConfig&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;@type&#34;</span>: <span style=color:#f1fa8c>&#34;type.googleapis.com/envoy.extensions.filters.listener.proxy_protocol.v3.ProxyProtocol&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=too-complex-envoy-gateway-to-the-rescue>Too Complex? Envoy Gateway to the Rescue!</h2><p>By using the above methods, we can obtain the client‚Äôs IP address in Envoy. These methods often require manual configuration within Envoy‚Äôs extensive configuration files, which can span thousands of lines.</p><p>As a data-plane infrastructure, <strong>Envoy‚Äôs configuration syntax is primarily designed for control plane usage, aiming to provide flexibility and customizability rather than a human-friendly UI</strong>. This syntax includes numerous detailed configuration options, often requiring a deep understanding of Envoy‚Äôs internal implementation details to configure correctly. As a result, it can be challenging for the average user to work directly with Envoy‚Äôs configuration files.</p><p><strong>One of the main goals of Envoy Gateway is to simplify the deployment and configuration of Envoy</strong>. <a href=https://gateway.envoyproxy.io>Envoy Gateway</a> uses Kubernetes Custom Resource Definitions (CRDs) to offer a higher level of abstraction over Envoy, hiding unnecessary details and making it easier for users to configure Envoy.</p><p><img src=https://zhaohuabing.com/static/img/2024-05-17-client-ip/client-ip-5.png alt></p><p><a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#clienttrafficpolicy>ClientTrafficPolicy</a> is a custom <a href=https://gateway-api.sigs.k8s.io>Gateway API</a> <a href=https://gateway-api.sigs.k8s.io/geps/gep-713>Policy</a> CRD defined by <a href=https://gateway.envoyproxy.io>Envoy Gateway</a>, designed to configure network traffic policies for clients connecting to the Envoy Proxy. Users can create a <a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#clienttrafficpolicy>ClientTrafficPolicy</a> to configure Envoy and obtain the client‚Äôs IP address.</p><p>In <a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#clienttrafficpolicy>ClientTrafficPolicy</a>, we can configure <code>clientIPDetection</code> to extract the client‚Äôs IP address from the X-Forwarded-For header or a custom header.</p><p>Here is an example of a <a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#clienttrafficpolicy>ClientTrafficPolicy</a> configuration that extracts the client‚Äôs IP address from the X-Forwarded-For header. This configuration takes the second rightmost IP address from the X-Forwarded-For header as the client‚Äôs IP address:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: gateway.envoyproxy.io/v1alpha1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: ClientTrafficPolicy
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: enable-client-ip-detection-xff
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>clientIPDetection</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>xForwardedFor</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>numTrustedHops</span>: <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>targetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>group</span>: gateway.networking.k8s.io
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>kind</span>: Gateway
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: my-gateway
</span></span></code></pre></div><p>If the client‚Äôs IP address is passed using a custom header, it can be extracted using the <code>customHeader</code> field. Here‚Äôs an example of a <a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#clienttrafficpolicy>ClientTrafficPolicy</a> configuration that retrieves the client‚Äôs IP address from the X-Real-IP custom header.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: gateway.envoyproxy.io/v1alpha1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: ClientTrafficPolicy
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: enable-client-ip-detection-custom-header
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>clientIPDetection</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>customHeader</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>name</span>: X-Real-IP
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>targetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>group</span>: gateway.networking.k8s.io
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>kind</span>: Gateway
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: my-gateway   
</span></span></code></pre></div><p>If the network middlewares on the request path support the proxy protocol, you can also enable it using the <code>enableProxyProtocol</code> field in <a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#clienttrafficpolicy>ClientTrafficPolicy</a>. Here‚Äôs an example of how to set up <a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#clienttrafficpolicy>ClientTrafficPolicy</a> to make Envoy pull the client‚Äôs IP address from the proxy protocol:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: gateway.envoyproxy.io/v1alpha1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: ClientTrafficPolicy
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: enable-proxy-protocol
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>enableProxyProtocol</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>targetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>group</span>: gateway.networking.k8s.io
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>kind</span>: Gateway
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: my-gateway
</span></span></code></pre></div><h2 id=leveraging-client-ip-address-for-traffic-management>Leveraging Client IP Address for Traffic Management</h2><p>With the help of <a href=https://gateway.envoyproxy.io>Envoy Gateway</a>, users can easily obtain the client‚Äôs IP address without digging into Envoy‚Äôs enormous configuration details. Once the client‚Äôs IP address is obtained, you can take it a step further‚Äîuse it with <a href=https://gateway.envoyproxy.io>Envoy Gateway</a>‚Äôs enhanced traffic management features like access control and rate limiting.</p><p>With <a href=https://gateway.envoyproxy.io>Envoy Gateway</a>‚Äôs <a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#securitypolicy>SecurityPolicy</a>, you can control access to your services based on the client‚Äôs IP address.</p><p>Below is an example configuration that only allows client IP addresses from the admin-region-us-east and admin-region-us-west regions to access the admin-route HTTPRoute. All other requests will be denied.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: gateway.envoyproxy.io/v1alpha1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: SecurityPolicy
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: authorization-client-ip
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>namespace</span>: gateway-conformance-infra
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>targetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>group</span>: gateway.networking.k8s.io
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>kind</span>: HTTPRoute
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: admin-route
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>authorization</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>defaultAction</span>: Deny
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: admin-region-us-east
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>action</span>: Allow
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>principal</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>clientCIDRs</span>:
</span></span><span style=display:flex><span>        - <span style=color:#bd93f9>10.0.1.0</span>/24
</span></span><span style=display:flex><span>        - <span style=color:#bd93f9>10.0.2.0</span>/24
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: admin-region-us-west
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>action</span>: Allow
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>principal</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>clientCIDRs</span>:
</span></span><span style=display:flex><span>        - <span style=color:#bd93f9>10.0.11.0</span>/24
</span></span><span style=display:flex><span>        - <span style=color:#bd93f9>10.0.12.0</span>/24
</span></span></code></pre></div><p>With <a href=https://gateway.envoyproxy.io>Envoy Gateway</a>‚Äôs <a href=https://gateway.envoyproxy.io/v1.0.1/api/extension_types/#backendtrafficpolicy>BackendTrafficPolicy</a>, you can implement rate limiting for client IP addresses. In the example configuration below, client IPs from the 192.168.0.0/16 range are restricted to 20 requests per second per IP. Any requests beyond this limit will be rejected.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: gateway.envoyproxy.io/v1alpha1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: BackendTrafficPolicy 
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: policy-httproute
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>targetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>group</span>: gateway.networking.k8s.io
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>kind</span>: HTTPRoute
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: myapp-route
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>namespace</span>: default
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>rateLimit</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>type</span>: Global
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>global</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>rules</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>clientSelectors</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>sourceCIDR</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>type</span>: <span style=color:#f1fa8c>&#34;Distinct&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>value</span>: <span style=color:#bd93f9>192.168.0.0</span>/16
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>limit</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>requests</span>: <span style=color:#bd93f9>20</span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>unit</span>: Second
</span></span></code></pre></div><h2 id=key-takeaways>Key Takeaways</h2><p>Before reaching the final destination server, a client‚Äôs request typically traverses multiple network hops, such as proxy servers and load balancers, and the original client IP is lost along the way.</p><p>Envoy provides several methods to obtain the client‚Äôs real IP address, including using the standard X-Forwarded-For header, custom HTTP headers, and the Proxy Protocol. Each method has its advantages and disadvantages, and Envoy supports all of them, allowing users to select the most appropriate solution based on their specific use cases.</p><p>While Envoy‚Äôs configuration syntax can be complex and challenging for average users, managing Envoy with <a href=https://gateway.envoyproxy.io>Envoy Gateway</a> significantly simplifies the process of retrieving the client IP from the request. Additionally, <a href=https://gateway.envoyproxy.io>Envoy Gateway</a> enables advanced use cases such as access control, rate limiting, and other client IP-based traffic management.</p><p>üëáüëáüëáDo you utilize client IP in your Gateway configuration? I love to hear about your use cases! Feel free to leave a comment below and share your insights.üëáüëáüëá</p><div class="entry-shang text-center"><p>„ÄåÁúüËØöËµûËµèÔºåÊâãÁïô‰ΩôÈ¶ô„Äç</p><button class="zs show-zs btn btn-bred">ËµûËµèÊîØÊåÅ</button></div><div class=zs-modal-bg></div><div class=zs-modal-box><div class=zs-modal-head><button type=button class=close>√ó</button>
<span class=author><a href=https://lopins.github.io/hugo-template/><img src=/hugo-template/img/favicon.png>Huabing Blog</a></span><p class=tip><i></i><span>ÁúüËØöËµûËµèÔºåÊâãÁïô‰ΩôÈ¶ô</span></p></div><div class=zs-modal-body><div class=zs-modal-btns><button class="btn btn-blink" data-num=2>2ÂÖÉ</button>
<button class="btn btn-blink" data-num=5>5ÂÖÉ</button>
<button class="btn btn-blink" data-num=10>10ÂÖÉ</button>
<button class="btn btn-blink" data-num=50>50ÂÖÉ</button>
<button class="btn btn-blink" data-num=100>100ÂÖÉ</button>
<button class="btn btn-blink" data-num=1>‰ªªÊÑèÈáëÈ¢ù</button></div><div class=zs-modal-pay><button class="btn btn-bred" id=pay-text>2ÂÖÉ</button><p>‰ΩøÁî®<span id=pay-type>ÂæÆ‰ø°</span>Êâ´Êèè‰∫åÁª¥Á†ÅÂÆåÊàêÊîØ‰ªò</p><img src=/hugo-template/img/reward/wechat-2.png id=pay-image></div></div><div class=zs-modal-footer><label><input type=radio name=zs-type value=wechat class=zs-type checked><span><span class=zs-wechat><img src=/hugo-template/img/reward/wechat-btn.png></span></label>
<label><input type=radio name=zs-type value=alipay class=zs-type class=zs-alipay><img src=/hugo-template/img/reward/alipay-btn.png></span></label></div></div><script type=text/javascript src=/hugo-template/js/reward.js></script><hr><ul class=pager><li class=previous><a href=/hugo-template/post/2024-05-17-client-ip/ data-toggle=tooltip data-placement=top title="Â¶Ç‰ΩïÈÄöËøá Envoy Gateway ÂæóÂà∞ÂÆ¢Êà∑Á´ØÁöÑÁúüÂÆû IP Âú∞ÂùÄÔºü">&larr;
Previous Post</a></li><li class=next><a href=/hugo-template/post/2024-06-16-eg-1.1.0/ data-toggle=tooltip data-placement=top title="Envoy Gateway v 1.1.0 ÁâàÊú¨ÂèëÂ∏ÉÔºöÊñ∞ÂäüËÉΩ‰∏éÊîπËøõ‰ªãÁªç">Next
Post &rarr;</a></li></ul><link href=https://xxx.xxx.com/dist/Artalk.css rel=stylesheet><script src=https://xxx.xxx.com/dist/Artalk.js></script><div id=Comments></div><script>Artalk.init({el:"#Comments",pageKey:"https://lopins.github.io/hugo-template/post/2024-05-17-client-ip-en/",pageTitle:"How to Get the Client‚Äôs ‚ÄúReal‚Äù IP Address with Envoy Gateway ?",server:"https://xxx.xxx.com",site:"xxx blog"})</script></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/aeraki title=aeraki>aeraki
</a><a href=/tags/aeraki-mesh title="aeraki mesh">aeraki mesh
</a><a href=/tags/ambient-mesh title="ambient mesh">ambient mesh
</a><a href=/tags/api-gateway title="api gateway">api gateway
</a><a href=/tags/bitcoin title=bitcoin>bitcoin
</a><a href=/tags/blockchain title=blockchain>blockchain
</a><a href=/tags/cka title=cka>cka
</a><a href=/tags/cncf title=cncf>cncf
</a><a href=/tags/cryptocurrency title=cryptocurrency>cryptocurrency
</a><a href=/tags/digital-signature title="digital signature">digital signature
</a><a href=/tags/docker title=docker>docker
</a><a href=/tags/dubbo title=dubbo>dubbo
</a><a href=/tags/envoy title=envoy>envoy
</a><a href=/tags/envoy-gateway title="envoy gateway">envoy gateway
</a><a href=/tags/ingress title=ingress>ingress
</a><a href=/tags/istio title=istio>istio
</a><a href=/tags/jaeger title=jaeger>jaeger
</a><a href=/tags/kafka title=kafka>kafka
</a><a href=/tags/knowledge-graph title="knowledge graph">knowledge graph
</a><a href=/tags/kubecon title=kubecon>kubecon
</a><a href=/tags/kubernetes title=kubernetes>kubernetes
</a><a href=/tags/linux title=linux>linux
</a><a href=/tags/loadbalancer title=loadbalancer>loadbalancer
</a><a href=/tags/metaprotocol title=metaprotocol>metaprotocol
</a><a href=/tags/microservice title=microservice>microservice
</a><a href=/tags/network title=network>network
</a><a href=/tags/network-service-mesh title="network service mesh">network service mesh
</a><a href=/tags/nfv title=nfv>nfv
</a><a href=/tags/nodeport title=nodeport>nodeport
</a><a href=/tags/onap title=onap>onap
</a><a href=/tags/opentracing title=opentracing>opentracing
</a><a href=/tags/pilot title=pilot>pilot
</a><a href=/tags/proxy-protocol title="proxy protocol">proxy protocol
</a><a href=/tags/redis title=redis>redis
</a><a href=/tags/sdn title=sdn>sdn
</a><a href=/tags/security title=security>security
</a><a href=/tags/service-mesh title="service mesh">service mesh
</a><a href=/tags/tencent title=tencent>tencent
</a><a href=/tags/x-forwarded-for title=x-forwarded-for>x-forwarded-for</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://zhaozhihan.com>LindaÁöÑÂçöÂÆ¢</a></li></ul></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:youremail@gmail.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=/hugo-template/your%20wechat%20qr%20code%20image><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-weixin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/yourgithub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/yourlinkedinid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/yourstackoverflowid><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Huabing Blog"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Huabing Blog 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/hugo-template/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>